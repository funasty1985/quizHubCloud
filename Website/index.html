<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload and Extract Text</title>
</head>
<body>

<input type="file" id="fileInput" accept="application/pdf,image/*">
<button onclick="uploadAndExtractText()">Upload and Extract Text</button>

<div id="extractedText" style="white-space: pre-wrap; margin-top: 20px;"></div>

<script>
    async function uploadAndExtractText() {
        const fileInput = document.getElementById("fileInput");
        const file = fileInput.files[0];
        if (!file) {
            console.log("No file selected.");
            return;
        }

        const base64String = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                const result = reader.result;
                const base64Data = result.substr(result.indexOf('base64,') + 'base64,'.length);
                resolve(base64Data);
            };
            reader.onerror = error => reject(error);
        });

        fetch("http://127.0.0.1:8000/upload", {
            method: "POST",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({filename: file.name, filebytes: base64String})
        })
        .then(response => response.ok ? response.json() : Promise.reject(response))
        .then(data => {
            console.log("Upload successful:", data);
            return fetch("http://127.0.0.1:8000/extract-text", {
                method: "POST",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({filename: file.name})
            });
        })
        .then(response => response.ok ? response.json() : Promise.reject(response))
        .then(extractionData => {
            console.log("Text Extraction successful:", extractionData);
            document.getElementById('extractedText').textContent = extractionData.extractedText;
            //document.getElementById('extractedText').textContent = extractionData.paragraphs.join("\n\n");
        })
        .catch(error => console.error("Error during upload or text extraction:", error));

        fileInput.value = "";
    }
</script>

</body>
</html>